<!DOCTYPE html>
<html>
<head th:replace="fragments/head :: includes">
</head>
<body>

	<div th:replace="fragments/navigation :: navbar"></div>
	<div style="margin-left: 25px; margin-right: 25px;">


		<h1 th:if="${#httpServletRequest.requestURI}=='/offer/add'">
			<span th:text="#{offerDetail.label.add}" th:remove="tag">title</span>
			<small th:text="#{label.required}">Subtitle</small>
		</h1>
		<h1 th:unless="${#httpServletRequest.requestURI}=='/offer/add'">
			<span th:text="#{offerDetail.label.modify}" th:remove="tag">title</span>
			<small th:text="#{label.required}">Subtitle</small>

		</h1>
		<form action="#" th:object="${offer}" class="form-horizontal"
			method="post" enctype="multipart/form-data">
			<input type="hidden" th:field="*{id}" />
			<div class="table-responsive">
				<table class="table">
					<tr>
						<td><label class="control-label" for="title"
							th:text="#{offer.label.title}">label</label>*</td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip" th:title="#{offerDetail.tooltip.title}"></span>
						</td>
						<td>
							<div class="form-group col-md-12"
								th:classappend="${#fields.hasErrors('title')}? has-error">
								<input type="text" th:field="*{title}" class="form-control"
									id="title" th:placeholder="#{offer.label.title.placeholder}" />
								<div th:if="${#fields.hasErrors('title')}? has-error"
									class="alert alert-danger" role="alert" th:errors="*{title}"></div>
							</div>
						</td>
					</tr>					
					<tr>
						<td><label class="control-label" for="description"
							th:text="#{offer.label.description}">desc</label>*</td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.description}"></span></td>
						<td>
							<div class="form-group col-md-12"
								th:classappend="${#fields.hasErrors('description')}? has-error">
								<textarea class="form-control" th:field="*{description}"
									id="description"
									th:placeholder="#{offer.label.description.placeholder}" />
								<div th:if="${#fields.hasErrors('description')}? has-error"
									class="alert alert-danger" role="alert"
									th:errors="*{description}"></div>
							</div>
						</td>
					</tr>	
					<tr>
						<td><label class="control-label" for="courseType" 
							th:text="#{offer.label.course}">course</label>*
						</td>
						<td style="width: 15px"><span 
							style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.course}"></span></td>
						<td>
							<div class="form-group col-md-12" th:each="course : ${courseTypes}" 
								th:classappend="${#fields.hasErrors('courseType')}? has-error">
								<input type="radio" th:field="${offer.courseType}" th:value="${course.getId()}"
									id="courseType"/>
									<label th:text="${course.getName()}"></label>
							</div>
							<div th:if="${#fields.hasErrors('courseType')}? has-error"
								 class="alert alert-danger" role="alert" th:errors="*{courseType}">Darf nicht null sein</div>
						</td>
					</tr>
					<tr>
							<td><label class="control-label" for="price"
							th:text="#{offer.label.price}">price</label>*</td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip" th:title="#{offerDetail.tooltip.price}"></span>
						</td>
						<td>
							<div class="form-group col-md-12"
								th:classappend="${#fields.hasErrors('price')}? has-error">
								<input type="text"
									th:field="*{price}" class="form-control" id="price" />
								<div th:if="${#fields.hasErrors('price')}? has-error"
									class="alert alert-danger" role="alert" th:errors="*{price}">Muss gr��er 0,00
									sein</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class="control-label" for="neededPoints"
							th:text="#{offer.label.neededPoints}">npoint</label>*</td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.neededPoints}"></span></td>
						<td>
						<div class="form-group col-md-12"
								th:classappend="${#fields.hasErrors('neededPoints')}? has-error">
								<input type="text" 
									th:field="*{neededPoints}" class="form-control"
									id="neededPoints" />
								<div th:if="${#fields.hasErrors('neededPoints')}? has-error"
									class="alert alert-danger" role="alert" th:errors="*{neededPoints}">Muss gr��er 0
									sein</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class="control-label" for="preparationTime"
							th:text="#{offer.label.preparationTime}">prepTime</label>*</td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.preparationTime}"></span></td>
						<td>
							<div class="form-group col-md-12"
								th:classappend="${#fields.hasErrors('preparationTime')}? has-error">
								<input type="text" 
									th:field="*{preparationTime}" class="form-control"
									id="preparationTime" />
								<div th:if="${#fields.hasErrors('preparationTime')}? has-error"
									class="alert alert-danger" role="alert" th:errors="*{preparationTime}">Muss gr��er 0
									sein</div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class="control-label"
							th:text="#{offerDetail.label.validityPeriod}">validityPeriod</label>*
						</td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.validityPeriod}"></span></td>
						<td>
							<div class="form-group col-md-3"
								th:classappend="${#fields.hasErrors('startDate')}? has-error">
								<div class='input-group' th:id="datetimepickerStartDate">
									<input type='text' th:field="*{startDate}" class="form-control"
										id="startDate" /> <span class="input-group-addon"> <span
										class="glyphicon glyphicon-calendar"></span>
									</span>
								</div>
								<div th:if="${#fields.hasErrors('startDate')}? has-error"
									class="alert alert-danger" role="alert"
									th:errors="*{startDate}"></div>
							</div>
							<div class="col-md-1" />
							<div class="form-group col-md-3"
								th:classappend="${#fields.hasErrors('endDate')}? has-error">
								<div class='input-group date' th:id="datetimepickerEndDate">
									<input type='text' th:field="*{endDate}" class="form-control"
										id="endDate" /> <span class="input-group-addon"> <span
										class="glyphicon glyphicon-calendar"></span>
									</span>
								</div>
								<div th:if="${#fields.hasErrors('endDate')}? has-error"
									class="alert alert-danger" role="alert" th:errors="*{endDate}"></div>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class="control-label" for="dayOfWeeks"
							th:text="#{offerDetail.label.dayOfWeeks}">dayOfWeeks</label></td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.dayOfWeeks}"></span></td>
						<td>
							<div class="col-md-8">
								<table class="table table-hover">
									<thead>
										<tr>
											<th th:text="#{restaurant.label.day}"></th>
											<th th:text="#{restaurant.label.offertimes.offerstarttime}"></th>
											<th th:text="#{restaurant.label.offertimes.offerendtime}"></th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="dayOfWeek : ${dayOfWeeks}">
											<td th:each="timeSchedule : ${restaurant.timeSchedules}"
												th:if="${timeSchedule.offerStartTime != null and timeSchedule.offerEndTime != null and dayOfWeek.id == timeSchedule.dayOfWeek.id}">
												<input type="checkbox" th:text="' ' + ${dayOfWeek.name}"
												th:field="${offer.dayOfWeeks}" th:value="${dayOfWeek.id}"
												id="dayOfWeeks" th:checked="false" />
											</td>
											<td th:each="timeSchedule : ${restaurant.timeSchedules}"
												th:text="${timeSchedule.offerStartTime != null} ? ${#dates.format(timeSchedule.offerStartTime, 'HH:mm')}"
												th:if="${timeSchedule.offerStartTime != null and dayOfWeek.id == timeSchedule.dayOfWeek.id}">Starttime
												of Offer</td>
											<td th:each="timeSchedule : ${restaurant.timeSchedules}"
												th:text="${timeSchedule.offerEndTime != null} ? ${#dates.format(timeSchedule.offerEndTime, 'HH:mm')}"
												th:if="${timeSchedule.offerEndTime != null and dayOfWeek.id == timeSchedule.dayOfWeek.id}">Endtime
												of Offer</td>
										</tr>
									</tbody>
								</table>
							</div>
							<div th:if="${#fields.hasErrors('dayOfWeeks')}? has-error"
								class="alert alert-danger col-md-12" role="alert"
								th:errors="*{dayOfWeeks}"></div>
						</td>
					</tr>
					<tr>
						<td><label class="control-label" for="additive"
							th:text="#{offerDetail.label.additive}">additive</label></td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.additive}"></span></td>
						<td>
							<div class="col-md-8">
								<table class="table table-hover">
									<thead>
										<tr>										
											<th th:text="#{restaurant.label.additives.inside}"></th>
											<th th:text="#{restaurant.label.additives.desc}"></th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="additive : ${additives}">
											<td>
												<input type="checkbox" th:text="' ' + ${additive.name}"
												th:field="${offer.additives}" th:value="${additive.id}"
												id="additives" th:checked="false" />
											</td>
											<td th:text="${additive.description}"></td>
										</tr>
									
									</tbody>
								</table>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class="control-label" for="allergenic"
							th:text="#{offerDetail.label.allergenic}">allergenic</label></td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip"
							th:title="#{offerDetail.tooltip.allergenic}"></span></td>
						<td>
							<div class="col-md-8">
								<table class="table table-hover">
									<thead>
										<tr>										
											<th th:text="#{restaurant.label.allergenic.inside}"></th>
											<th th:text="#{restaurant.label.allergenic.desc}"></th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="allergenic : ${allergenic}">
											<td>
												<input type="checkbox" th:text="' ' + ${allergenic.name}"
												th:field="${offer.allergenic}" th:value="${allergenic.id}"
												id="allergenic" th:checked="false" />
											</td>
											<td th:text="${allergenic.description}"></td>
										</tr>
									
									</tbody>
								</table>
							</div>
						</td>
					</tr>
					<tr>
						<td><label class="control-label" for="images"
							th:text="#{offerDetail.label.images}">images</label></td>
						<td style="width: 15px"><span style="padding-top: 7px"
							class="glyphicon glyphicon-question-sign" data-placement="left"
							data-toggle="tooltip" th:title="#{offerDetail.tooltip.images}"></span>
						</td>
						<td>
							<div class="form-group col-md-8">
								<div th:if="${blockedFileUpload}" class="alert alert-danger"
									 role="alert" th:text="#{offer.upload.blockedFileUpload}"></div>
								<div th:if="${invalidPicture}" class="alert alert-danger"
									role="alert" th:text="#{offer.upload.invalidFileType}"></div>
								<div class="fileinput fileinput-new" data-provides="fileinput">
									<div class="fileinput-preview thumbnail"
										data-trigger="fileinput" style="width: 200px; height: 150px;"></div>
									<div>
										<span class="btn btn-default btn-file"><span
											class="fileinput-new"
											th:text="#{offerDetail.button.selectImage}">Select
												image</span><span class="fileinput-exists"
											th:text="#{offerDetail.button.changeImage}">Change</span><input
											type="file" name="img" accept="image/*" /></span> <a href="#"
											class="btn btn-default fileinput-exists"
											data-dismiss="fileinput"
											th:text="#{offerDetail.button.removeImage}">Remove</a>
										<button class="btn btn-default btn-file fileinput-exists"
											type="submit" name="addImage"
											th:text="#{offerDetail.button.addImage}" />
									</div>
								</div>
								<table class="table">
									<thead>
										<tr>
											<th th:text="#{label.preview}">Preview</th>
											<th th:text="#{label.action}">Operations</th>
										</tr>
									</thead>
									<tbody>
										<tr th:each="picture,status : *{offerPhotos}">
											<td><img
												th:src="*{'data:image/jpeg;base64,' + offerPhotos[__${status.index}__].base64Encoded}"
												class="img-thumbnail" width="200" height="200" /></td>
											<td>
												<button type="submit" class="btn btn-default"
													name="deleteImage" th:value="${status.index}">
													<span class="glyphicon glyphicon-trash" aria-hidden="true"></span>
												</button>
											</td>
										</tr>
									</tbody>
								</table>
							</div>
						</td>
					</tr>
					<tr>
						<td></td>
						<td style="width: 15px"></td>
						<td>
							<button type="submit" class="btn btn-success" name="saveOffer"
								th:text="#{offerDetail.button.save}">save</button>
							<button class="btn btn-danger" type="button"
								th:text="#{button.delete}" th:if="${#strings.startsWith(#httpServletRequest.servletPath,'/offer/edit/')}"
								th:attr="data-href=@{/offer/delete/{id}(id=*{id})}"
								data-toggle="modal" data-target="#confirm-delete">delete</button>
							<button type="submit" class="btn btn-danger" name="cancel"
								th:text="#{button.cancel}">Cancel</button>
						</td>
					</tr>
				</table>
			</div>

			<input type="hidden"
				   th:name="${_csrf.parameterName}"
				   th:value="${_csrf.token}" />

		</form>
	</div>
	<br />
	<br />

	<div th:replace="fragments/footer :: footer"></div>
	
		<div class="modal fade" id="confirm-delete" tabindex="-1" role="dialog"
		aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">

				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal"
						aria-hidden="true">&times;</button>
					<h4 class="modal-title" id="myModalLabel"
						th:text="#{delete.label.title}">Confirm Delete</h4>
				</div>

				<div class="modal-body">
					<p th:text="#{delete.label.offer.message}">delete message</p>
					<p th:text="#{delete.label.attention}">attention message</p>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-default" data-dismiss="modal"
						th:text="#{button.cancel}">Cancel</button>
					<a class="btn btn-danger btn-ok" th:text="#{button.delete}">Delete</a>
				</div>
			</div>
		</div>
	</div>




	<script>
		$('#confirm-delete').on(
				'show.bs.modal',
				function(e) {
					$(this).find('.btn-ok').attr('href',
							$(e.relatedTarget).data('href'));

					$('.debug-url').html(
							'Delete URL: <strong>'
									+ $(this).find('.btn-ok').attr('href')
									+ '</strong>');
				});
	</script>

	<script type="text/javascript">
		$(function() {
			$("[id^=datetimepicker]").datetimepicker({
				locale : 'de',
				format : 'DD.MM.YYYY'
			});
		});

		$(document).ready(function() {
			$('[data-toggle="tooltip"]').tooltip();
		});
	</script>
</body>
</html>